#pragma once

#include <array>
#include <cstdint>

#include <pybind11/numpy.h>
#include <pybind11/pybind11.h>

#include "game_logic.h"

struct NativeMCTSResult {
    int chosen_action_idx = 0;
    std::array<float, 69> visit_probs{};
    float root_value = 0.0f;

    pybind11::array_t<float> visit_probs_array() const;
};

// Note: search performs per-simulation root determinization by shuffling only
// the three hidden tier deck orders before each simulation.
NativeMCTSResult run_native_mcts(
    const GameState& root_state,
    pybind11::function evaluator,
    int turns_taken,
    int num_simulations = 64,
    float c_puct = 1.25f,
    int temperature_moves = 10,
    float temperature = 1.0f,
    float eps = 1e-8f,
    bool root_dirichlet_noise = false,
    float root_dirichlet_epsilon = 0.25f,
    float root_dirichlet_alpha_total = 10.0f,
    int eval_batch_size = 32,
    std::uint64_t rng_seed = 0
);
